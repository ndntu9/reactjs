# Effect, state và events

Xét ví dụ dưới đây

```js
import { useState } from "react";

function App() {
    const [count, setCount] = useState(0);

    function handleButtonClick() {
        setCount((prevCount) => prevCount + 1);
        console.log(count);
    }

    return (
        <>
            <h1>{count}</h1>
            <button onClick={handleButtonClick}>Add 1</button>
        </>
    );
}
```

Khi nhấn vào Add 1, giá trị của count sẽ tăng lên 1 và gọi console.log

Tuy nhiên tại thời điểm đó count chưa tăng lên 1, nên console.log vẫn in ra giá trị cũ

Để khắc phục lỗi này, cần sử dụng effect với deps là biến count

```js
import { useState, useEffect } from "react";

function App() {
    const [count, setCount] = useState(0);

    useEffect(() => {
        console.log(count);
    }, [count]);

    function handleButtonClick() {
        setCount((prevCount) => prevCount + 1);
    }

    return (
        <>
            <h1>{count}</h1>
            <button onClick={handleButtonClick}>Click me</button>
        </>
    );
}
```

# Hiệu suất của effect

Giả sử gọi localStorage trong 1 component React, nên gọi trong useEffect vì 2 lí do:

-   Đó là hiệu ứng phụ
-   Hiệu suất của ứng dụng

Với ví dụ dưới, React sẽ phải đợi localStorage rồi mới return ra JSX để render ra giao diện, dẫn đến việc hiển thị giao diện người dùng chậm

```js
import { useState } from "react";
import data from "./data.js";

function App() {
    const [random, setRandom] = useState(Math.random());

    localStorage.setItem("data", JSON.stringify(data));

    return (
        <>
            <h1>{random}</h1>
            <button>Re-render</button>
        </>
    );
}
```

Khi sử dụng useEffect, useEffect sẽ được gọi sau khi component được render, nên sẽ không bị delay do localStorage

```js
import { useState, useEffect } from "react";
import data from "./data.js";

function App() {
    const [random, setRandom] = useState(Math.random());

    useEffect(() => {
        localStorage.setItem("data", JSON.stringify(data));
    });

    return (
        <>
            <h1>{random}</h1>
            <button>Re-render</button>
        </>
    );
}
```
