# Dependencies trong useEffect

> Dependencies trong useEffect là 1 mảng chứa các state, quyết định khi nào useEffect sẽ được gọi. Mảng deps có thể có nhiều hoặc chỉ có 1 state

Ví dụ: useEffect nhận deps là counter, khi counter thay đổi thì useEffect sẽ được gọi

```js
import { useState, useEffect } from "react";

function App() {
    const [counter, setCounter] = useState(0);

    useEffect(() => {
        console.log("effect is running");
    }, [counter]);

    return (
        <button onClick={() => setCounter((prev) => prev + 1)}>Click me</button>
    );
}
```

# Hiệu ứng chỉ chạy 1 lần

Nếu chỉ cần useEffect chạy 1 lần duy nhất (khi component được render lần đầu), cần truyền 1 mảng deps trống

Khi đó, deps sẽ không thay đổi sau nên useEffect không bao giờ bị gọi lại

```js
useEffect(() => {
    const map = new mapboxgl.Map({
        container: "#map",
        style: "mapbox://styles/mapbox/streets-v11",
        center: [10, 20],
        zoom: 13
    });
}, []);
```

# Vòng đời của component

useEffect có thể gọi được vào các giai đoạn khác nhau của component, ví dụ

-   Sau lần đầu tiên component được gắn kết (thêm vào DOM)

```js
import { useEffect } from "react";

function App() {
    useEffect(() => {
        console.log("Once after component mounted");
    }, []);
}
```

-   Sau mỗi lần component được hiển thị lại

```js
import { useEffect } from "react";

function App() {
    useEffect(() => {
        console.log(
            "After it mounted the first time and after every re-render"
        );
    });
}
```

-   Sau khi component bị hủy gắn kết (xóa khỏi DOM)

```js
import React, { useEffect } from "react";

function App() {
    useEffect(() => {
        console.log("Once after component mounted");

        return () => {
            console.log("Once before component unmounted");
        };
    }, []);
}
```

-   Sau mỗi lần hiển thị lại, khi một biến trạng thái thay đổi

```js
import { useEffect, useState } from "react";

function App(props) {
    const [first, setFirst] = useState(0);
    const [second, setSecond] = useState(0);

    useEffect(() => {
        console.log("Only when first and/or props.user change.");
    }, [first, props.user]);
}
```
